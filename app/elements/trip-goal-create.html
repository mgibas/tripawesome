<link rel="import" href="../bower_components/polymer/polymer.html">
<dom-module id="trip-goal-create">
    <template>
        <style include="shared-styles">
        :host {
            display: block;
        }

        trip-goal-search-item {
            width: 100%;
        }

        [title] {
            pointer-events: all !important;
        }
        </style>
        <firebase-document id="fb" app-name="tripawesome" data="{{_newGoal}}"></firebase-document>
        <google-map-search id="search" api-key="AIzaSyDIaWkbQnlyk4iRyNNAGtNudHsjQTdC2qg" map="[[map]]" query="[[_debouncedSearchQuery]]" results="{{places}}" radius="100000" types="point_of_interest amusement_park aquarium art_gallery library bakery bar cafe movie_theater campground museum night_club park casino cemetery church city_hall restaurant shopping_mall spa stadium synagogue zoo neighborhood">
        </google-map-search>
        <google-map api-key="AIzaSyDIaWkbQnlyk4iRyNNAGtNudHsjQTdC2qg" map="{{map}}" latitude="[[latitude]]" longitude="[[longitude]]"></google-map>
        <app-toolbar role="search">
            <div title>
                <paper-input value="{{_searchQuery}}" label="Search For Something To Do"></paper-input>
            </div>
        </app-toolbar>
        <paper-listbox selected-item="{{_selectedPlace}}">
            <template is="dom-repeat" items="[[places]]" as="item">
                <paper-item item="[[item]]">
                    <trip-goal-search-item item="[[item]]"></trip-goal-search-item>
                </paper-item>
            </template>
        </paper-listbox>
    </template>
    <script>
    (() => {
        'use strict';
        class TripGoalCreate {
            get is() {
                return 'trip-goal-create';
            }
            get properties() {
                return {
                    _searchQuery: {
                        type: String,
                        observer: '_searchQueryChanged'
                    },
                    _canSelect: {
                        type: Boolean,
                        value: false
                    }
                };
            }
            save() {
                this._newGoal = {
                    location: {
                        name: this._selectedPlace.item.name,
                        placeId: this._selectedPlace.item.place_id,
                        latitude: this._selectedPlace.item.latitude,
                        longitude: this._selectedPlace.item.longitude
                    }
                };
                if (this._selectedPlace.item.photos.length > 0)
                    this._newGoal.location.photoUrl = this._selectedPlace.item.photos[0].getUrl({
                        maxHeight: 100,
                        maxWidth: 100
                    });
                this.$.fb.save(`/trips/${this.key}/goals`)
                    .then(() => {
                        this.$.fb.reset();
                        this._newGoal = {};
                        this.fire('created');
                    });
            }
            reset() {
                this._searchQuery = null;
                this.places = null;
            }
            _searchQueryChanged(value) {
                this.debounce('update-search-query', () => {
                    this._debouncedSearchQuery = this._searchQuery;
                }, 200);
            }
        }
        Polymer(TripGoalCreate);
    })();
    </script>
</dom-module>
