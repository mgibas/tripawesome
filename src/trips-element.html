<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="trip-item.html">
<dom-module id="trips-element">
    <template>
        <style include="iron-flex iron-flex-alignment">
            :host {
                display: block;
                @apply(--layout-vertical);
                padding-top: 1rem;
            }

            trip-item + trip-item {
                margin-top: 0.3rem;
            }

            trip-item[deleted] {
                margin-top: 0rem;
            }
            
            paper-fab {
                position: fixed;
                bottom: 10px;
                right: 10px;
            }
        </style>
        <firebase-collection id="tripsFb" location="https://project-910504469268581197.firebaseio.com/trips" data="{{trips}}"></firebase-collection>
        <template is="dom-repeat" items="{{trips}}" as="item">
            <trip-item item="[[item]]" on-delete-trip="_deleteTrip"></trip-item>
        </template>
        <paper-fab icon="add" on-tap="_addTrip"></paper-fab>
    </template>
    <script>
        (() => {
            'use strict';

            class TripsElement {
                get is() {
                    return 'trips-element'
                }
                get properties() {
                    return {
                        trips: {
                            type: Array,
                            notify: true,
                            value: []
                        }
                    };
                }
                _addTrip() {
                    this.$.tripsFb.add({
                        name: `New trips`
                    });
                }
                _deleteTrip(e, deleteInfo) {
                    deleteInfo.timeoutId = setTimeout(() => {
                        this.$.tripsFb.remove(deleteInfo.trip)
                    }, deleteInfo.timeout);
                }
            }
            Polymer(TripsElement);
        })();
    </script>
</dom-module>
