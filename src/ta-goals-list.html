<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="ta-day-dependent-behavior.html">
<link rel="import" href="ta-goals-collection.html">
<link rel="import" href="ta-goal-item.html">
<link rel="import" href="ta-goal-item-distance.html">

<dom-module id="ta-goals-list">
    <template>
        <style>
        trip-goals-distance,
        trip-goal-item {
            width: 100%;
        }
        </style>
        <ta-goals-collection id="collection" user-uid="[[userUid]]" trip-key="[[tripKey]]" day-key="[[dayKey]]" goals="{{goals}}"></ta-goals-collection>
        <template is="dom-repeat" items="{{goals}}" as="goal" sort="_sortGoals" observe="priority">
            <a href="/trips/[[tripKey]]/details/days/[[dayKey]]/details/goals/[[goal.$key]]/details">
                <ta-goal-item goal="[[goal]]" on-move-up="_handleMoveUp" on-move-down="_handleMoveDown"></ta-goal-item>
            </a>
            <template is="dom-if" if="[[goal.distanceToNext]]">
                <ta-goal-item-distance distance="[[goal.distanceToNext]]"></ta-goal-item-distance>
            </template>
        </template>
    </template>
    <script>
    (() => {
        'use strict';
        class TaGoalsList {
            get is() {
                return 'ta-goals-list';
            }
            get behaviors() {
                return [TaDayDependentBehavior];
            }
            get properties() {
                return {};
            }
            _sortGoals(a, b) {
                return a.priority - b.priority;
            }
            _handleMoveUp(e, goal) {
                this.$.collection.decreasePriority(goal.$key);
            }
            _handleMoveDown(e, goal) {
                this.$.collection.increasePriority(goal.$key);
            }
        }
        Polymer(TaGoalsList);
    })();
    </script>
</dom-module>
