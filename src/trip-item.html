<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">

<dom-module id="trip-item">
    <template>
        <style>
            :host {
                display: block;
                @apply(--layout-vertical);
            }

            [hidden],
            .hidden {
                display: none;
            }

            paper-toast a {
                color: var(--accent-color);
            }

            paper-card {
                @apply(--layout-flex);
            }
        </style>
        <app-location route="{{route}}"></app-location>
        <firebase-document id="fb" app-name="triptrip" data="[[item]]" path="/trips/[[item.$key]]">
        </firebase-document>
        <paper-card class="trip" heading="[[item.name]]" hidden$="[[deleted]]" on-tap="_handleTap">
            <div id="actions" class="card-actions">
                <paper-icon-button icon="social:share"></paper-icon-button>
                <paper-icon-button icon="delete" on-tap="_delete"></paper-icon-button>
            </div>
        </paper-card>
        <paper-toast id="deleteToast" text="Trip '[[item.name]] was deleted." duration="5000">
            <a on-tap="_undoDelete">Undo</a>
        </paper-toast>
    </template>
    <script>
        (() => {
            'use strict';

            class TripItem {
                get is() {
                    return 'trip-item'
                }
                get properties() {
                    return {
                        item: {
                            type: Object
                        },
                        deleted: {
                            type: Boolean,
                            value: false,
                            reflectToAttribute: true
                        }
                    };
                }
                _delete() {
                    this.deleted = true;
                    this.$.deleteToast.open();
                    this.deleteTimeoutId = setTimeout(() => {
                        this.$.fb.destroy()
                    }, 5000);
                }
                _undoDelete() {
                    clearTimeout(this.deleteTimeoutId);
                    this.deleted = false;
                    this.$.deleteToast.close();
                }
                _handleTap(e) {
                    if (e.target === this.$.actions || e.target.parentElement === this.$.actions) return
                    console.log('tap')
                    this.set('route.path',`/trip/${this.item.$key}`)
                }
            }
            Polymer(TripItem);
        })();
    </script>
</dom-module>
